
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Contextual validation &#8212; Validol  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Infinitely-extendable" href="extendable_validation.html" />
    <link rel="prev" title="It’s declarative" href="declarative_validation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="contextual-validation">
<h1>Contextual validation<a class="headerlink" href="#contextual-validation" title="Permalink to this headline">¶</a></h1>
<p>Here we will consider different ways to carry out validation, what is contextual validation and why it beats all the other ways.</p>
<div class="section" id="context-independent-validation-bound-to-data-model">
<h2>Context-independent validation bound to data-model<a class="headerlink" href="#context-independent-validation-bound-to-data-model" title="Permalink to this headline">¶</a></h2>
<p>Most of current frameworks compel us, its users, to put validation in data model. At least, default mode for most of us
is to simply bind validation rules to specific fields in data model. What’s wrong with this approach?</p>
<p>Consider an example where a guest registers a new food delivery order. The company behind this service, which actually cooks the order, is called SuperFood.
That’s how the whole user-story looks like: Vasya as a guest visits SuperFood’s site and registered an order there.</p>
<p>SuperFood’s backend service must ensure several constraints before putting stuff in a database.
One of them is to ensure that either email or phone number are passed.</p>
<p>Now suppose another user registers an order in SuperFood, but through some aggregator service, call it AggreA. This order doesn’t differ much from the one registered on SuperFood site,
though the constraints to be enforced are different. For example, passing a phone number is essential for that aggregator, while email is optional.</p>
<p>Now, a third user registers an order in SuperFood, and she does it through some else aggregator service, AggreB.
And for that one, passing a phone number is not needed, but email is a must.</p>
<p>So we have the following situation. I have a single data-model for an order, but there are at least three contexts with different set of constraints.
I can go traditional way: introduce an entity corresponding to a database row, and impose that constraints through annotations or config files or whatever way I’m get used to.
Data-model validation favors the following approach:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ValidContactInfo</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">phoneNumber</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Custom annotation <code class="docutils literal notranslate"><span class="pre">ValidContactInfo</span></code> eventually brings us to the <a class="reference external" href="https://stackoverflow.com/a/44326568/618020">custom validator</a>,
something like <code class="docutils literal notranslate"><span class="pre">ContactInfoValidator</span></code>. Its clearest implementation reflects the mental model of product-manager,
which goes like the following (in a pseudo code):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">order</span> <span class="n">is</span> <span class="n">being</span> <span class="n">registered</span> <span class="n">through</span> <span class="n">site</span><span class="o">,</span> <span class="n">then</span> <span class="n">either</span> <span class="n">email</span> <span class="n">or</span> <span class="n">phone</span> <span class="n">number</span> <span class="n">must</span> <span class="n">be</span> <span class="n">present</span><span class="o">.</span>
<span class="n">If</span> <span class="n">order</span> <span class="n">is</span> <span class="n">being</span> <span class="n">registered</span> <span class="n">through</span> <span class="n">AggreA</span><span class="o">,</span> <span class="n">phone</span> <span class="n">is</span> <span class="n">required</span><span class="o">.</span>
<span class="n">If</span> <span class="n">order</span> <span class="n">is</span> <span class="n">being</span> <span class="n">registered</span> <span class="n">through</span> <span class="n">AggreB</span><span class="o">,</span> <span class="n">email</span> <span class="n">is</span> <span class="n">required</span><span class="o">.</span>
</pre></div>
</div>
<p>The primary objective is to find out <em>somehow</em> what exactly is the concrete scenario it operates within.</p>
<p>Data-model way implies that we should do that in a validator, taking fields from entity data-object.
This way I believe is the least palatable one, since we can’t use the power of domain model and have to reside the validation logic
in <a class="reference external" href="https://www.yegor256.com/2014/05/05/oop-alternative-to-utility-classes.html">service classes</a>.
Simplified, it roughly looks like that:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContactInfoValidator</span>
<span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Site</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">order</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">order</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">AggreA</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">order</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">AggreB</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">order</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Unknown source given&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="better-context-independent-validation-in-domain-objects">
<h2>Better: context-independent validation in domain objects<a class="headerlink" href="#better-context-independent-validation-in-domain-objects" title="Permalink to this headline">¶</a></h2>
<p>Often times, validation logic shawn in previous example gets out of control. In this case, it could be more
beneficial to put it in domain object responsible for business-logic. It could look like the following (mind the naming:
I renamed <code class="docutils literal notranslate"><span class="pre">Order</span></code> to <code class="docutils literal notranslate"><span class="pre">OrderFromRequest</span></code>):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DomainOrder</span>
<span class="o">{</span>
    <span class="kd">public</span> <span class="nf">DomainOrder</span><span class="o">(</span><span class="n">OrderFromRequest</span> <span class="n">orderFromRequest</span><span class="o">)</span>
    <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">register</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// save in db</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">Site</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">AggreA</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getSource</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">new</span> <span class="n">AggreB</span><span class="o">()))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">orderFromRequest</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;Unknown source given&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="the-best-contextual-validation-that-is-specific-to-a-concrete-user-story">
<h2>The best: contextual validation that is specific to a concrete user story<a class="headerlink" href="#the-best-contextual-validation-that-is-specific-to-a-concrete-user-story" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Validol</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="declarative_validation.html">It’s declarative</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contextual validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="extendable_validation.html">Infinitely-extendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_why.html">The Why</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_how.html">The How</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="the_why.html">The Why</a><ul>
      <li>Previous: <a href="declarative_validation.html" title="previous chapter">It’s declarative</a></li>
      <li>Next: <a href="extendable_validation.html" title="next chapter">Infinitely-extendable</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Vadim Samokhin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/context_specific_validation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>